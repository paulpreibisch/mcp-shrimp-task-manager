# 🦐 Shrimp Task Manager v3.1.0 Release Notes

## 🎉 New Features

### 1️⃣ Initial Request Display

### Overview
Version 3.1.0 introduces a game-changing feature that addresses a common user need: **understanding the context behind task lists**. The new **Initial Request Display** feature captures and prominently displays the original user request that initiated task planning, providing essential context for why tasks were created.

![Initial Request Feature](/releases/initial-request-feature.png)

### 🌟 Key Highlights

#### 📋 **Persistent Context**
- The initial user request is now automatically saved when using the `plan_task` tool
- Provides a clear understanding of the project's origin and purpose
- Helps team members quickly grasp the overall objective without diving into individual tasks

#### 🎨 **Beautiful Dark Theme UI**
- Seamlessly integrated with the existing dark theme design
- Clean, modern interface with the signature Shrimp color palette
- Positioned prominently above the task table for immediate visibility

#### 🔄 **Collapsible Interface**
- **Expandable/Collapsible design** to maximize screen real estate
- Smooth animations with rotating arrow indicator
- Remembers your preference during the session
- Click the header to toggle between expanded and collapsed states

### 📸 Feature in Action

The screenshot above shows the Initial Request feature displaying a comprehensive project request that initiated the task planning process.

**Key Visual Elements:**
- 🏷️ **"Initial Request" header** in the accent teal color (`#4fbdba`)
- 📄 **Full request text** displayed in a readable format with proper line breaks
- ▼ **Collapse arrow** that rotates when toggling the view
- 🎨 **Dark theme styling** matching the rest of the application (`#16213e` background)

### 🔧 Technical Implementation

#### Backend Enhancements
- **New `TasksData` structure** that includes:
  - `initialRequest`: Stores the original planning request
  - `createdAt`: Timestamp when tasks were first created
  - `updatedAt`: Last modification timestamp
  - `tasks`: Array of task objects (existing structure)

#### Smart Backward Compatibility
- **Automatic format detection** for existing task files
- Old format (array of tasks) → New format (TasksData object) conversion
- Zero breaking changes - all existing installations continue to work
- Graceful handling of missing initial requests in legacy files

#### API Updates
- Server endpoints now return initial request data alongside tasks
- Maintains response structure compatibility with older clients
- Efficient caching to reduce server load

### 🌍 Internationalization
Full support for all 7 languages:
- 🇬🇧 English: "Initial Request"
- 🇨🇳 Chinese: "初始请求"
- 🇪🇸 Spanish: "Solicitud Inicial"
- 🇵🇹 Portuguese: "Solicitação Inicial"
- 🇹🇷 Turkish: "İlk Talep"
- 🇰🇷 Korean: "초기 요청"
- 🇯🇵 Japanese: "初期リクエスト"

### 🧪 Testing
Comprehensive test coverage ensures reliability:
- ✅ Backend data structure tests
- ✅ Task planning integration tests
- ✅ Backward compatibility tests

### 📈 Benefits

1. **Improved Team Collaboration**
   - New team members can quickly understand project context
   - Reduces need for external documentation
   - Creates a self-documenting task system

2. **Better Task Management**
   - Clear connection between request and resulting tasks
   - Easier to validate that tasks align with original requirements
   - Helps identify scope creep or missing requirements

3. **Enhanced User Experience**
   - Clean, unobtrusive design that doesn't interfere with task management
   - Optional visibility through collapsible interface
   - Consistent with existing UI patterns

### 🚀 How to Use

1. **For New Task Plans**: When you use the task planner, your initial request is automatically saved
2. **Viewing**: The initial request appears above the task table in the viewer
3. **Toggling**: Click the header to expand/collapse the request display
4. **For Existing Projects**: The feature works with all existing task files (initial request will be empty for legacy files)

### 🔄 Migration Guide

**No action required!** The feature is fully backward compatible:
- Existing task files continue to work without modification
- New task plans automatically use the enhanced format
- The viewer handles both formats seamlessly

### 2️⃣ Project Setup Command

#### Overview
The new **`setup_project`** MCP command revolutionizes how you initialize projects for task management. With a single command, you can instantly configure any repository to work with the Shrimp Task Manager.

#### 🎯 Key Features

##### 🚀 **One-Command Setup**
Simply say: `"use task-manager to set up new project"`
- Automatically configures the current project
- No manual configuration required
- Works with any git repository or project folder

##### 🤖 **Smart Profile Generation**
- Auto-generates meaningful profile names from project paths
- Intelligently uses folder names for context
- Avoids generic parent folders (like 'repos', 'projects')
- Example: `/home/user/projects/my-awesome-app` → `my_awesome_app`

##### 📁 **Automatic File Management**
- Creates data directory if it doesn't exist
- Initializes `tasks.json` with project metadata
- Updates `~/.shrimp-task-viewer-settings.json` automatically
- Handles existing projects gracefully (updates instead of duplicating)

#### 💻 How to Use

**Basic Usage:**
```
"use task-manager to set up new project"
```

**With Custom Profile Name:**
```
"use setup_project with profileName: 'my-custom-name'"
```

**From Specific Path:**
```
"use setup_project with projectPath: '/path/to/project'"
```

#### 📝 What Gets Created

1. **Settings Entry** in `~/.shrimp-task-viewer-settings.json`:
   ```json
   {
     "profileName": "your_project_name",
     "taskPath": "/path/to/data/your_project_name_tasks.json",
     "projectRoot": "/path/to/your/project",
     "addedAt": "2025-08-31T16:35:09.510Z"
   }
   ```

2. **Tasks File** with initial metadata:
   ```json
   {
     "tasks": [],
     "initialRequest": "Project: your_project_name\nCreated: ...\nPath: ...",
     "createdAt": "2025-08-31T16:35:09.521Z",
     "updatedAt": "2025-08-31T16:35:09.521Z"
   }
   ```

#### 🔄 Integration with Task Viewer
- Project immediately appears in the project tabs
- Ready for task planning and management
- Fully compatible with all existing features
- Works seamlessly with the Initial Request Display feature

#### 💡 Use Cases
- **New Repository Setup**: Instantly configure a freshly cloned repo
- **Multiple Projects**: Manage tasks across different projects easily
- **Team Onboarding**: Quick setup for new team members
- **Context Switching**: Effortlessly switch between project contexts

### 3️⃣ AI-Powered Agent Assignment

#### Overview
Version 3.1.0 introduces **AI-Powered Agent Assignment**, a revolutionary feature that intelligently assigns specialized agents to multiple tasks simultaneously using OpenAI's GPT models. This feature dramatically accelerates project planning by automatically matching tasks with the most suitable agents based on their descriptions and requirements.

#### 🤖 Key Features

##### **Bulk AI Assignment**
- Select multiple tasks and assign agents to all of them with a single click
- Uses OpenAI GPT models to analyze task descriptions and match them with the best agents
- Supports both global agents (from Claude folder) and project-specific agents
- Visual feedback with the distinctive robot emoji (🤖) button with green border

##### **Smart Agent Matching**
- AI analyzes task names, descriptions, and technical requirements
- Considers agent specializations and capabilities
- Provides intelligent fallback to general-purpose agents when specialized ones aren't suitable
- Maintains context awareness across related tasks

##### **Enhanced UI Controls**
- New bulk action button: "🤖 AI Assign Agents (X tasks selected)"
- Green-bordered robot emoji buttons for individual task commands
- Test IDs added for reliable automated testing
- Loading states and progress indicators during AI processing

#### 💻 How to Use

1. **Select Tasks**: Check the boxes next to tasks you want to assign agents to
2. **Click AI Assign**: Click the "🤖 AI Assign Agents" button in the bulk actions bar
3. **Automatic Processing**: AI analyzes tasks and assigns optimal agents
4. **Review Results**: Tasks are updated with assigned agents immediately

#### 🔧 Technical Implementation

- **OpenAI Integration**: Uses GPT-3.5-turbo or GPT-4 for intelligent agent matching
- **Batch Processing**: Efficiently handles multiple tasks in a single API call
- **Error Handling**: Graceful fallback for API key issues with helpful configuration guidance
- **Test Coverage**: Comprehensive test suite with 100% coverage of AI assignment features

#### ⚙️ Configuration

Set your OpenAI API key in one of these ways:
- **Environment Variable**: `OPENAI_API_KEY=your-key-here`
- **Settings File**: Configure in Global Settings within the app
- **Project .env**: Add to your project's `.env` file

#### 🧪 Testing Improvements

- Created comprehensive test suite for AI assignment feature
- Added test IDs to all interactive buttons for reliable testing
- Mock API responses for isolated unit testing
- Error scenario coverage including API key configuration

### 5️⃣ Manual Bulk Agent Assignment Dropdown

#### Overview
Version 3.1.0 introduces a **Manual Bulk Agent Assignment Dropdown** that provides instant, user-controlled agent assignment for multiple tasks. Unlike the AI-powered assignment, this feature allows users to directly select a specific agent and assign it to all selected tasks immediately.

#### 🎯 Key Features

##### **Instant Manual Assignment**
- Select multiple tasks and choose any available agent from a dropdown
- Immediate assignment without AI processing time
- Supports both "assign agent" and "no agent" options
- Perfect for when you know exactly which agent you want to use

##### **Enhanced Bulk Actions Bar**
- **Left side**: Shows "X tasks selected:" with the new agent assignment dropdown
- **Right side**: Maintains the existing AI assignment button
- **Better organization**: Clean separation between manual and AI-powered options
- **Responsive design**: Properly styled dropdown matching the dark theme

##### **Seamless Integration**
- Works alongside existing AI-powered assignment
- Dropdown lists all available agents (global and project-specific)
- Maintains agent colors and styling consistency
- Resets to placeholder text after assignment

#### 💻 How to Use

1. **Select Tasks**: Check the boxes next to multiple tasks
2. **Choose Agent**: Click the "Assign Agent..." dropdown in the bulk actions bar
3. **Select Option**: Choose any available agent or "No agent" to unassign
4. **Instant Assignment**: All selected tasks are immediately updated

#### 🎨 UI Enhancements
- Custom styled dropdown with dark theme integration
- Hover effects and proper disabled states
- Consistent with existing UI components
- Clear visual separation between manual and AI options

### 6️⃣ No-Refresh Agent Assignment

#### Overview
A significant **User Experience improvement** that eliminates the annoying page refresh when assigning agents to individual tasks. The interface now updates immediately without losing your place in the task list.

#### 🚀 Key Improvements

##### **Optimistic UI Updates**
- Agent assignments update instantly in the interface
- No more waiting for page refresh after selecting an agent
- Background server synchronization with error handling
- Visual feedback with saving indicators

##### **Smart Error Handling**
- Immediate UI updates for responsive feel
- Automatic reversion if server update fails
- Toast notifications for success and error states
- Maintains data integrity with proper error recovery

##### **Local State Management**
- Implements intelligent local state caching
- Merges server data with pending local updates
- Preserves user interactions during network requests
- Seamless experience even with slower connections

#### 💻 Technical Implementation

##### **Advanced State Management**
- Added `localTaskUpdates` state for tracking pending changes
- Created `mergedData` to combine server data with local updates
- Implemented optimistic update pattern with rollback capability
- Maintains full compatibility with existing data structures

##### **Performance Optimizations**
- Reduces server requests by batching updates intelligently
- Eliminates unnecessary full page refreshes
- Improves responsiveness of individual agent assignments
- Background synchronization without user interruption

#### 🧪 Enhanced Testing
- Comprehensive test coverage for both bulk and individual assignment
- Mock server responses for reliable testing
- Error scenario testing including network failures
- UI state consistency validation

#### 🎯 Benefits

1. **Improved Productivity**
   - No more losing your place when assigning agents
   - Faster task management workflow
   - Reduced context switching and waiting time

2. **Better User Experience**
   - Instant visual feedback for all actions
   - Smooth, modern interface behavior
   - Professional-grade responsiveness

3. **Robust Error Handling**
   - Graceful recovery from network issues
   - Clear feedback when operations fail
   - Data consistency maintained at all times

### 7️⃣ Tasks Export Feature

#### Overview
Version 3.1.0 introduces a comprehensive **Tasks Export Feature** that allows users to export their task data in multiple formats with flexible filtering options. This feature was developed using **Test-Driven Development (TDD)** methodology, ensuring robust functionality with **40 comprehensive tests** covering all aspects of the export system.

#### 🎯 Key Features

##### **Multi-Format Export**
- **CSV Export**: Professional CSV format with proper character escaping for commas, quotes, and special characters
- **Markdown Export**: Comprehensive format with **complete task details** including:
  - **Initial Request**: The original request that started the task planning (displayed at the top)
  - **Numbered Tasks**: All tasks are numbered (Task 1, Task 2, etc.) for easy reference
  - **Complete Details**: Descriptions, notes, implementation guides, verification criteria, assigned agents, dependencies, related files, and all metadata
- Clean, structured output suitable for sharing, documentation, or data analysis

##### **Smart Status Filtering**
- **Selective Export**: Choose which task statuses to include (Completed, In Progress, Pending)
- **Real-time Preview**: Live task count showing how many tasks will be exported based on current filters
- **Flexible Selection**: Export all tasks or filter by specific status combinations

##### **Intuitive Modal Interface**
- **Clean UI**: Professional modal design matching the dark theme with detailed feature description
- **Format Selection with Descriptions**: Clear explanations of what each format includes (CSV for basic info, Markdown for complete details)
- **Status Checkboxes**: Visual checkboxes for each task status with live updates
- **Export Preview**: Shows exact number of tasks selected before export
- **Responsive Design**: Works seamlessly across different screen sizes

#### 💻 How to Use

1. **Access Export**: Click the "📤 Export" button on the tasks page
2. **Choose Format**: Select CSV for spreadsheet use or Markdown for documentation
3. **Filter Tasks**: Check/uncheck status types to include (Completed, In Progress, Pending)
4. **Preview Count**: See real-time count of tasks that will be exported
5. **Export**: Click "Export" to download the file instantly

#### 🔧 Technical Implementation

##### **Test-Driven Development**
- **40 Comprehensive Tests**: Complete test coverage using Vitest and React Testing Library
- **Red-Green-Refactor**: Proper TDD methodology followed throughout development
- **Test Categories**:
  - Export utilities: 19 tests covering CSV generation, Markdown formatting, filtering, task numbering, and initial request inclusion
  - Modal component: 21 tests covering UI interactions, state management, and edge cases

##### **Advanced CSV Export**
```javascript
// Proper CSV escaping for special characters
export const exportToCSV = (tasks) => {
  // Handles commas, quotes, newlines with proper RFC 4180 compliance
  // Headers: ID, Name, Description, Status, Created At, Updated At
};
```

##### **Rich Markdown Export**
```javascript
// Comprehensive markdown with complete task details
export const exportToMarkdown = (tasks, initialRequest) => {
  // Includes initial request at the top of the document
  // Numbers all tasks for easy reference (Task 1, Task 2, etc.)
  // Groups tasks by status with summary statistics
  // Includes ALL task details: descriptions, notes, implementation guides,
  // verification criteria, assigned agents, dependencies, related files
  // Professional formatting with proper structure and metadata
};
```

##### **Smart File Download**
- **Modern Browser APIs**: Uses Blob API and URL.createObjectURL for instant downloads
- **Automatic Filename Generation**: Creates descriptive filenames with timestamps
- **Memory Management**: Proper cleanup of temporary URLs
- **Cross-browser Compatibility**: Works across all modern browsers

##### **React State Management**
- **Optimistic UI Updates**: Instant feedback with proper error handling
- **Local State Caching**: Efficient state management for modal interactions
- **Toast Notifications**: Success and error feedback for user actions

#### 🧪 Quality Assurance

##### **Comprehensive Testing**
- **Export Utilities Tests** (16 tests):
  - CSV format validation and character escaping
  - Markdown structure and content verification
  - Status filtering logic and edge cases
  - Empty data handling

- **Modal Component Tests** (21 tests):
  - UI rendering and interaction testing
  - State management verification
  - User workflow validation
  - Accessibility compliance

##### **Edge Case Coverage**
- Empty task lists
- Tasks with special characters in names/descriptions
- Missing or invalid task data
- Network error scenarios
- Large dataset performance

#### 🎨 UI/UX Enhancements

##### **Export Button Integration**
- **Strategic Placement**: Located in tasks page controls for easy access
- **Smart Enabling**: Disabled when no tasks available or while loading
- **Visual Consistency**: Matches existing button styling and dark theme
- **Clear Icon**: 📤 export icon for instant recognition

##### **Modal Design**
- **Dark Theme Integration**: Seamless integration with existing design system
- **Feature Description**: Clear explanation of export functionality and use cases at the top of modal
- **Format Descriptions**: Inline descriptions showing what each format includes (CSV basic info vs Markdown complete details)
- **Overlay Interaction**: Click outside to close with proper event handling
- **Keyboard Navigation**: Full keyboard accessibility support
- **Loading States**: Clear feedback during export processing

#### 🚀 Benefits

1. **Enhanced Productivity**
   - Quick data export for reporting and analysis
   - Multiple format options for different use cases
   - Flexible filtering reduces manual data processing

2. **Professional Output**
   - Clean CSV format perfect for Excel/Google Sheets with basic task information
   - Comprehensive Markdown format ideal for complete project documentation with all task details
   - Proper character encoding and formatting for both formats

3. **Robust Implementation**
   - 100% test coverage ensures reliability
   - TDD approach guarantees quality
   - Comprehensive error handling prevents data loss

4. **User Experience Excellence**
   - Intuitive interface requires no learning curve
   - Real-time feedback and preview functionality
   - Consistent with existing UI patterns

#### 📊 Export Formats

##### **CSV Format**
- Headers: ID, Name, Description, Status, Created At, Updated At
- RFC 4180 compliant with proper escaping
- Excel/Google Sheets compatible
- Perfect for data analysis and reporting

##### **Markdown Format**
```markdown
# Tasks Export
**Export Date:** YYYY-MM-DD
Total tasks: X

## Initial Request
[Original request that started the task planning]

---

## Summary Statistics
- **Completed:** X
- **In Progress:** X  
- **Pending:** X

---

### Status: [Status Name]

## Task 1: [Task Name]

**Description:**
[Task Description]

**Notes:**
[Task Notes]

**Implementation Guide:**
[Implementation Guide]

**Verification Criteria:**
[Verification Criteria]

**Assigned Agent:** [Agent Name]

**Dependencies:**
- [Dependency 1]
- [Dependency 2]

**Related Files:**
- ➕ **file1.js** (CREATE) - Description [Lines: 1-50]
- ✏️ **file2.js** (TO_MODIFY) - Description

**Metadata:**
- **ID:** [Task ID]
- **Status:** [Status]
- **Created:** YYYY-MM-DD
- **Updated:** YYYY-MM-DD

---
```

### 8️⃣ Test Infrastructure Enhancements

#### Overview
Version 3.1.0 includes significant improvements to the testing infrastructure, ensuring robust test coverage and reliable development workflows. Major focus on component testing, API mocking, and i18n integration.

#### 🧪 Key Improvements

##### **Enhanced Test Setup**
- **Comprehensive i18n Integration**: Proper initialization with full translation resources for all components
- **Browser API Mocks**: Complete mocking of PerformanceObserver, ResizeObserver, IntersectionObserver
- **Fetch API Mocking**: Comprehensive endpoint coverage with realistic response structures
- **Storage Mocking**: Full localStorage and sessionStorage implementations

##### **TemplateManagement Component Testing**
- **100% Test Coverage**: All 26 tests passing with comprehensive functionality coverage
- **Status Badge Testing**: Complete support for all template statuses (default, custom, env-override, env-append)
- **Translation Integration**: Proper i18n setup with all required translation keys
- **Action Button Testing**: Full coverage of edit, preview, duplicate, activate, and reset functionality

##### **Template API Testing**
- **Server Response Structure**: Fixed API response format to include `functionName` and `category` properties
- **Environment Variable Detection**: Enhanced pattern matching for environment-based templates
- **Error Handling**: Comprehensive testing of edge cases and error scenarios

##### **AI Agent Assignment Testing**
- **New Test Suite**: Created comprehensive tests for AI-powered bulk agent assignment feature
- **API Integration**: Mock OpenAI API responses with proper error handling
- **User Interaction**: Complete coverage of UI interactions and state management

#### 📊 Test Results Progress
- **Before**: 153 failing tests across multiple components
- **After**: Significant reduction with core components now fully tested
  - ✅ **TemplateManagement**: 26/26 tests passing
  - ✅ **Template API**: Core endpoint tests passing
  - ✅ **AI Agent Assignment**: Complete test coverage

### 🐛 Bug Fixes
- Fixed task file format handling in server response
- Improved error handling for malformed JSON files
- Enhanced cache management for better performance
- Added directory creation for data paths to prevent ENOENT errors
- **Fixed agent command copying**: Robot emoji (🤖) now includes full project path when copying agent commands, ensuring they work correctly regardless of current directory
  - Global agents: Now includes full Claude folder path (e.g., `/home/user/claude/agents/fullstack.md`)
  - Project agents: Now includes full project root path (e.g., `/home/user/project/.claude/agents/fullstack.md`)
- **Enhanced robot emoji buttons**: Added colored borders (yellow and green) for better visibility and distinction
- **Agent Info Modal Descriptions**: Fixed blank description issue by ensuring hardcoded agent descriptions are always used
  - Added comprehensive descriptions for test-expert, react-optimizer, ui-developer, and architect agents
  - Enhanced fallback descriptions for unknown agents with proper formatting
- **Production Tasks JSON**: Fixed malformed JSON causing 500 errors in production task files

### 4️⃣ Direct Task Execution Button

#### Overview
A new **mechanical arm emoji button (🦾)** has been added alongside the existing robot button for each task. This feature allows direct task execution using the agent's role and expertise without launching a sub-agent, providing better visibility into task execution while still leveraging agent specializations.

#### 🟢 Key Features

##### **Direct Execution Mode**
- Mechanical arm emoji button (🦾) with green border for visual distinction
- Executes tasks directly using Claude's main context instead of launching sub-agents
- Maintains agent role and expertise application without sub-agent overhead
- Perfect for users who want visibility into task execution steps

##### **Smart Command Generation**
- For task manager: `Use task planner to execute this task: [UUID]`
- For specialized agents: `Use task planner to execute this task: [UUID] using the role of [agent] agent`
- Automatically includes task UUID for precise task identification
- Clear instructions to apply agent's specialized knowledge directly

##### **Enhanced User Experience**
- Two execution modes side-by-side for maximum flexibility
- Robot button (🤖 with yellow border): Launches sub-agent for autonomous execution
- Mechanical arm button (🦾 with green border): Direct execution with role-based guidance
- Visual feedback when command is copied to clipboard
- Tooltips clearly explain each button's function

#### 💻 How to Use

1. **Choose Execution Mode**:
   - **Robot Button (🤖 - Yellow Border)**: Click to copy command that launches a sub-agent
   - **Mechanical Arm Button (🦾 - Green Border)**: Click to copy command for direct execution with agent role

2. **Paste and Execute**: Paste the copied command to Claude to execute the task

3. **Benefits of Direct Mode**:
   - See exactly what's happening during task execution
   - Maintain control over the execution process
   - Still benefit from agent's specialized knowledge and approach
   - Avoid sub-agent overhead for simpler tasks

---

**Full Changelog**: v3.0.0...v3.1.0

*Released: August 31, 2025*