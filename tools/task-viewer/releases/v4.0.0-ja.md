# 🦐 Shrimp Task Manager v4.0.0 リリースノート

*リリース日: 2025年9月3日*

## 📋 目次

- [主要な新機能](#主要な新機能)
  - [初期リクエスト表示・要約生成](#初期リクエスト表示要約生成)
  - [強化されたリリースノート体験](#強化されたリリースノート体験)
  - [アーカイブ管理システム](#アーカイブ管理システム)
  - [強化されたエージェント管理](#強化されたエージェント管理)
  - [再設計された履歴ビュー](#再設計された履歴ビュー)
- [技術的改善](#技術的改善)
  - [パフォーマンス・インフラストラクチャー](#パフォーマンスインフラストラクチャー)
  - [テストカバレッジ](#テストカバレッジ)
- [重要なバグ修正](#重要なバグ修正)
  - [スクロール問題の解決](#スクロール問題の解決)
  - [UI/UX修正](#uiux修正)
- [アップグレード方法](#アップグレード方法)
- [今後の予定](#今後の予定)

## 🎉 主要な新機能

### 💡 初期リクエスト表示・要約生成

タスクリストの背景にあるコンテキストを確認・理解する機能が利用できるようになりました。初期リクエスト表示は、タスク計画を開始した元のユーザーリクエストを記録し、永続的に保存します。これにより、数週間または数ヶ月後でも、これらのタスクが存在する理由と解決すべき問題を即座に思い出すことができます。

さらに、OpenAIを活用してタスクの完了状況について簡潔な概要を生成するインテリジェントな要約機能も追加されました。要約ボタンをクリックし、OpenAI APIキーを使用することで、システムがすべての完了タスクを分析し、進捗状況の明確な概要を提供します。これは、プロジェクトの状況報告、チームコミュニケーション、または複雑な実装における現状把握にとって非常に価値があります。

### 📖 強化されたリリースノート体験

リリースノートシステムが一から完全に再設計されました。静的なテキストではなく、サイドバーに折りたたみ可能な目次を含む、インタラクティブでナビゲート可能な体験を提供します。各バージョンを展開してセクション概要を表示し、必要な情報に素早くジャンプできます。

実装には、色分けされた見出しを含む洗練されたスタイリングが含まれています - メインセクションはピンク、「新機能」は白、「バグ修正」はオレンジ、概要セクションはライトブルーです。テキストは読みやすくするために25%大きくなり、h2からh5までのすべてのマークダウン要素が適切にレンダリングされます。

サイドバーとコンテンツエリアは独立してスクロールし、膨大なドキュメンテーションをナビゲートしながら現在位置を見失うことがありません。カスタムのティール色テーマのスクロールバーがアプリケーションのデザイン言語と視覚的一貫性を提供します。

### 📚 アーカイブ管理システム

アーカイブ機能は、タスクリスト管理の方法を革命的に変えます。詳細な初期リクエストから複雑なタスクセットを作成したが、最初に別のことに取り組む必要があることに気づいた経験はありませんか？アーカイブシステムはこの問題を完璧に解決します。

タスクリストをアーカイブすると、タスクコレクション全体（それらを生成した初期リクエストも含む）が後の使用のために安全に保存されます。これにより、以前の計画作業を失うことなく、新しいタスクリストでフレッシュスタートできます。アーカイブされたタスクに戻る準備ができたら、現在のワークフローに簡単にインポートし直せます。これは、複数の機能を同時に作業する開発者や、頻繁にコンテキストを切り替える必要がある開発者にとって特に有用です。

アーカイブインターフェースは履歴ページと同じ洗練されたデザインを共有し、アプリケーション全体で一貫した直感的なユーザー体験を提供します。すべてのアーカイブされたタスクリストを表示し、作成日時を確認し、必要なときに任意のアーカイブを素早く復元できます。

![アーカイブダイアログ](./archive-dialog.png)
*タスクタブのアーカイブボタンを押すと表示される「現在のタスクをアーカイブ」ダイアログ。アーカイブされる内容の要約（プロジェクト名、タスク数、ステータス内訳、これらのタスクを作成した完全な初期リクエストを含む）を表示*

アーカイブリストビューは、初期リクエストとタスク統計と共にアーカイブされたすべてのタスクリストを表示します：

![アーカイブリスト](./archive-list.png)
*アーカイブされたタスクリストのリストを表示するアーカイブタブ。ユーザーは「表示」をクリックしてアーカイブされたタスクリスト内のすべてのタスクを確認したり、「削除」でアーカイブを永続的に削除したり、「インポート」ボタンを押してタスクを現在のワークフローに復元したりできる*

アーカイブを復元する準備ができたら、インポートダイアログで現在のリストにタスクを追加するか、完全に置き換えるかのオプションが提供されます：

![アーカイブインポートダイアログ](./archive-import.png)
*インポートボタンを押すと表示されるアーカイブインポートダイアログ。アーカイブされたタスクを復元するための柔軟なオプション（現在のタスクリストに追加するか、既存のタスクを完全に置き換えるか）を提供*

インポート後は、完全な初期リクエストとタスク内訳を含む、アーカイブされたタスクのすべての詳細を表示できます：

![アーカイブ詳細ビュー](./archive-details.png)
*初期リクエストと要約を含む完全なタスクリストを表示するアーカイブ詳細ページ*

### 新しいMCPツールの追加

Task Viewerにアーカイブと履歴機能が追加されたので、MCPツールも更新してClaude エージェントがアーカイブと履歴を完全にコントロールできるようにしました。

アーカイブと履歴機能へのプログラマティックアクセスを提供するための包括的なMCP（Model Context Protocol）ツールセットが実装されました。これらのツールにより、AIエージェントと外部システムが構造化されたAPIを通じてタスク管理ワークフローと連携できます。

**7つの新しいMCPツール：**

- **create_archive**: 整理のためのオプション説明付きで現在のタスクリストのバックアップを作成
- **list_archives**: 作成日とタスク数を含むメタデータと共にアーカイブされた全タスクリストを参照
- **restore_from_archive**: マージまたは置換オプションでアーカイブされたタスクを現在のワークフローにインポート
- **get_task_history**: すべてのタスク変更、更新、状態遷移の包括的監査証跡を取得
- **get_deleted_tasks**: 復旧または監査目的で削除されたタスクの情報にアクセス
- **recover_task**: 一意の識別子により以前に削除されたタスクを復元
- **sync_task_state**: 異なるストレージ場所間でのタスクデータ整合性を同期し競合を解決

各ツールには堅牢なZodスキーマ検証、包括的なエラーハンドリング、バイリンガルテンプレートサポート（英語/中国語）が含まれています。実装は既存のタスクモデルとの適切なTypeScript統合を特徴とし、ウェブインターフェースとの完全な互換性を維持します。

### 🤖 強化されたエージェント管理

このリリースでエージェント機能が大幅に拡張されました。新しい一括エージェント割り当て機能により、直感的なドロップダウンインターフェースを通じて複数のタスクにAIエージェントを同時に割り当てできます。個別のタスク割り当てはページ更新なしで実行され、ワークフローがよりスムーズで効率的になりました。

エージェント情報モーダルは完全に刷新され、より明確な説明とエージェント機能の可視性が向上しました。エージェントの説明が空白で表示される重要な問題や、プロダクションタスクリストで作業する際の500エラーが修正されました。

### 📊 再設計された履歴ビュー

履歴ビューは、アーカイブシステムの洗練されたインターフェースに合わせて変身しました。最も重要なのは、メインビューでノートではなく初期リクエストを表示するようになったことで、各履歴タスクリストの即座のコンテキストを提供します。レイアウトは、より良いカラム間隔とより効率的なフィルタリング機能で最適化されました。

## 🔧 技術的改善

### パフォーマンス・インフラストラクチャー

アプリケーションのパフォーマンスと開発体験に大幅な改善が加えられました。新しいビルドシステムには、自動的にビルドしてサーバーを起動する簡略化された`npm run build`コマンドが含まれます。Playwrightがエンドツーエンドテスト用に統合され、アップデート全体でのUI信頼性を確保します。

サーバーは改善されたエラーハンドリングと検証を特徴とする新しいアーカイブエンドポイントで強化されました。より良いデータ取得戦略により応答時間が最適化されています。

**MCPサーバーアーキテクチャ：**

MCPサーバー実装は、Claudeとの信頼性のある通信のためにStdioServerTransportを持つ低レベルのServerクラスを使用します。アーキテクチャには以下が含まれます：

- `ListToolsRequestSchema`と`CallToolRequestSchema`用の`setRequestHandler`による適切なツール登録
- 包括的なツール定義によるサーバー機能宣言
- 詳細なロギングとユーザーフレンドリーなエラーメッセージによる堅牢なエラーハンドリング
- JSON永続性と自動バックアップによるメモリベースのタスクストレージ
- 動的コンテンツ生成によるバイリンガルテンプレートサポート

### テストカバレッジ

このリリースには、すべての新機能に対する包括的なテストカバレッジが含まれます：
- アーカイブ機能テスト
- リリースノートスクロールテスト
- 履歴ビュー統合テスト
- エージェント割り当てテスト
- 要約生成テスト
- **MCPツール検証テスト**: 実際のタスク作成、アーカイブ、復元シナリオによる完全なアーカイブ/復元ワークフローテスト
- **テンプレート処理テスト**: Handlebarsテンプレートレンダリングと変数置換の検証
- **エラーハンドリングテスト**: 全MCPツールにわたるエッジケースと失敗シナリオの包括的テスト

## 🐛 重要なバグ修正

### スクロール問題の解決

リリースノートやその他のタブに影響していた重要なスクロールバー表示問題が修正されました。アプリケーションは現在、カスタムスタイリングでスクロールバーを適切に表示し、コンテンツが常にアクセス可能であることを保証します。サイドバーとコンテンツエリア間の独立したスクロールが完璧に動作します。

### UI/UX修正

- 折りたたみ可能セクションでの矢印位置が修正されました
- インターフェース全体でカラーコントラストが改善されました
- ローディング状態がより有益になりました
- エラーメッセージがより明確なガイダンスを提供します

### リリース後修正（2025年9月）

初期リリース後にいくつかの重要な問題が特定され、解決されました：

#### スクロールスパイと目次修正

- **スクロールスパイ重複ハイライトを修正**: 「使用方法」のような同一名のセクションが複数のTOCエントリを同時にハイライトしていました。親コンテキストを使用した一意のID生成を実装し、スクロール時に正しいセクションのみがハイライトされるようにしました。
- **破損したスクロールスパイハイライトを修正**: 一意のID実装後、スクロールスパイ機能が完全に動作しなくなりました。目次解析とコンテンツレンダリング間の一貫性を確保するため、中央集権的なID生成関数を追加しました。
- **リリースノートの全て折りたたむボタンを修正**: 不正確なバージョンスコープ処理により、ボタンが機能していませんでした。バージョンパラメーターを受け入れ、正しいリリースバージョンを渡すよう展開/折りたたみ関数を更新しました。

#### 用語と日付修正

- **モーダル用語を更新**: 「新しいプロファイルを追加」モーダルをインターフェース全体で「プロジェクト」用語を一貫して使用するよう変更しました。英語翻訳を「プロファイル名」ではなく「プロジェクト名」を表示するよう更新しました。
- **v4.0.0リリース日を修正**: リリース日を2025年1月2日から実際のリリース日の2025年9月3日に修正しました。

#### MCPサーバーとテンプレート処理修正

- **関数名競合を修正**: MCPツールとモデル関数間の重複関数名により引き起こされるサーバークラッシュを解決しました。`getDeletedTasksTool` → `getDeletedTasks`と`recoverTaskTool` → `recoverTask`を適切なインポートエイリアシングで更新しました。
- **テンプレート処理問題を修正**: 欠落していたテンプレートファイル（`empty.md`、`noResults.md`、`success.md`）を作成し、ジェネレーターとテンプレート間の変数名マッピングを修正することで、ツール応答に生のHandlebars構文が表示される問題を解決しました。
- **MCPツール登録を修正**: ツールエクスポート命名と登録を修正し、7つの新しいツールすべてがMCPインターフェースを通じて適切にアクセス可能であることを確保しました。
- **TypeScriptコンパイルエラーを修正**: フィルタ関数の非同期/await問題を解決し、オプションパラメーターに適切な型アサーションを追加しました。

これらの修正により、適切なナビゲーション、一貫した用語、正確なリリース情報、完全に機能するMCPツール統合によるスムーズなユーザー体験が保証されます。

## 📝 アップグレード方法

v4.0.0へのアップグレードは簡単です：

1. リポジトリから最新の変更をプル
2. `npm install`を実行して依存関係を更新
3. `npm run build`を実行してアプリケーションをビルド・起動
4. すべての新しいスタイルが読み込まれるよう、ブラウザキャッシュをクリア

これだけです！データベースの移行は必要ありません - ビルドして実行するだけです。

## 🚀 今後の予定

バージョン4.0.0は、Shrimp Task Managerの新しい標準を設定します。アーカイブ管理、初期リクエスト追跡、要約生成、強化されたリリースノートシステム、包括的なMCP API統合の組み合わせは、複雑な開発ワークフロー管理のための強力なツールキットを作り出します。

新しいMCPアーカイブと履歴ツールシステムは以下の可能性を開きます：
- 外部開発ツールとCI/CDパイプラインとの統合
- AIエージェントによって駆動される自動化されたタスク管理ワークフロー
- タスクデータへのプログラマティックアクセスを通じた強化されたコラボレーション
- 開発進捗に関する高度な分析とレポート
- 反復的なタスク管理操作のためのカスタム自動化スクリプト

この基盤により、Shrimp Task Managerは単独のツールとしてだけでなく、より大きな開発エコシステムの中核コンポーネントとして位置づけられます。