# 🚀 Task Viewer v3.0.0 发行说明

*发布日期：2025年8月7日*

## 📑 目录

- [🎉 主要新功能](#-主要新功能)
  - [🤖 代理管理系统](#-代理管理系统)
  - [🤖 AI驱动的批量代理分配](#-ai驱动的批量代理分配)
  - [📊 任务历史的Git版本控制](#-任务历史的git版本控制)
  - [📊 项目历史视图](#-项目历史视图)
  - [🎨 模板管理系统](#-模板管理系统)
  - [🌍 国际化(i18n)支持](#-国际化i18n支持)
  - [🧭 增强的导航和UI](#-增强的导航和ui)
- [🔄 重大改进](#-重大改进)
  - [任务详情导航](#任务详情导航)
  - [性能增强](#性能增强)
  - [开发者体验](#开发者体验)
  - [UI/UX改进](#uiux改进)
- [🐛 错误修复](#-错误修复)
  - [关键修复](#关键修复)
  - [UI修复](#ui修复)
  - [数据处理](#数据处理)
- [🏗️ 技术更新](#️-技术更新)
  - [新增依赖](#新增依赖)
  - [API增强](#api增强)
  - [架构改进](#架构改进)
- [📝 破坏性更改](#-破坏性更改)
  - [配置更新](#配置更新)
  - [API更改](#api更改)
- [🚀 迁移指南](#-迁移指南)
- [🎯 总结](#-总结)

## 🎉 主要新功能

### 🤖 代理管理系统
**用于专门任务处理的全面子代理管理**

SHRIMP-TASK-MANAGER现在支持强大的代理管理功能，允许您为不同类型的任务定义和使用专门的AI代理。代理是专门的AI个性或技能集，可以分配给任务以实现最佳执行。此功能与Claude的代理系统无缝集成，使您能够利用存储在`.claude/agents`文件夹中的自定义代理。

主要功能包括：

- **代理列表视图**：从您的`.claude/agents`文件夹浏览所有可用代理的详细信息
- **代理分配**：通过任务表中的下拉菜单为任务分配特定代理
- **代理查看器弹出窗口**：点击任务表中的眼睛图标（👁️）打开弹出式代理查看器，您可以滚动浏览不同的代理并为每个任务选择合适的代理
- **代理编辑器**：内置编辑器，支持代理元数据的颜色自定义
- **全局和项目代理**：支持项目特定和全局代理定义
- **一键AI指令**：点击机器人表情符号将代理特定的指令复制到剪贴板
- **代理列表AI指令**：代理列表中新增AI指令列，带有机器人表情符号（🤖），可复制`use subagent [agent-name] located in [path]:`直接在Claude中使用
- **代理信息模态框**：详细的代理信息，可在代理之间导航
- **元数据集成**：代理分配直接保存到tasks.json
- **颜色编码**：使用自定义颜色视觉区分代理

#### 代理分配工作流程：
1. **查看可用代理**：访问代理选项卡查看`.claude/agents`文件夹中的所有代理
2. **分配给任务**：使用任务表中的下拉菜单为每个任务选择代理
3. **复制指令**：点击机器人表情符号复制：`use the built in subagent located in ./claude/agents/[agent-name] to complete this shrimp task: [task-id] please when u start working mark the shrimp task as in progress`
4. **编辑代理**：修改代理内容和元数据，包括自定义颜色

![代理列表视图与AI指令](/releases/agent-list-view-with-ai-instruction.png)
*代理列表视图显示所有可用代理，带有AI指令列 - 点击机器人表情符号（🤖）可直接将代理使用指令如`use subagent debugger.md located in ./claude/agents to perform:`复制到剪贴板*

![任务表中的代理下拉菜单](/releases/agent-dropdown-task-table.png)
*使用任务表中的下拉选择器为任务分配代理*

![代理查看器弹出窗口](/releases/agent-viewer-popup.png)
*点击眼睛图标（👁️）打开代理查看器弹出窗口，浏览可用代理进行任务分配*

![带颜色选择的代理编辑器](/releases/agent-editor-color-selection.png)
*编辑代理内容并自定义颜色以便视觉组织*

![代理复制指令工具提示](/releases/agent-copy-instruction-tooltip.png)
*点击机器人表情符号复制代理特定的任务指令*

![代理信息模态框](/releases/agent-info-modal.png)
*浏览代理的详细信息并轻松导航*

![代理的全局设置](/releases/global-settings-agents.png)
*配置全局Claude文件夹路径以访问系统范围的代理*

### 🤖 AI驱动的批量代理分配
**使用OpenAI GPT-4自动为多个任务分配最合适的代理**

Task Viewer现在集成了OpenAI的GPT-4，可根据任务描述和要求智能地为任务分配代理。此功能大大减少了为大量任务配置适当代理所需的时间。

主要功能包括：

- **批量选择**：使用任务表中的复选框选择多个任务
- **一键分配**：点击"AI分配代理"自动为所有选定任务分配代理
- **智能匹配**：GPT-4分析任务描述和代理能力以做出最佳分配
- **全局设置集成**：在全局设置选项卡中配置您的OpenAI API密钥
- **环境变量支持**：也支持`OPENAI_API_KEY`或`OPEN_AI_KEY_SHRIMP_TASK_VIEWER`环境变量
- **错误指导**：如果未配置API密钥，提供清晰的说明

#### 设置说明：
1. **配置API密钥**：转到设置 → 全局设置并输入您的OpenAI API密钥
2. **选择任务**：使用复选框选择需要代理分配的任务
3. **AI分配**：点击批量操作栏中的"🤖 AI分配代理"按钮
4. **自动处理**：GPT-4将分析任务并分配最合适的代理

![全局设置OpenAI密钥](/releases/global-settings-openai-key.png)
*在全局设置中配置您的OpenAI API密钥以进行AI驱动的代理分配*

![AI批量代理分配](/releases/ai-bulk-agent-assignment.png)
*选择多个任务并点击"🤖 AI分配代理（已选择5个任务）"使用GPT-4自动分配适当的代理*

### 📊 任务历史的Git版本控制
**自动Git提交跟踪您任务的每个更改**

SHRIMP-TASK-MANAGER现在包含内置的Git集成，可自动跟踪对tasks.json文件的所有更改。这提供了任务修改的完整审计跟踪，无需任何手动干预。

主要功能包括：

- **自动Git仓库**：首次使用时在数据目录中初始化Git仓库
- **带时间戳的提交**：每个任务操作（创建、更新、删除）都会创建一个带有本地时区时间戳的提交
- **描述性消息**：提交包含对更改内容的清晰描述（例如，"添加新任务：实现用户身份验证"）
- **非阻塞**：Git操作包装在try-catch块中 - 如果Git失败，任务操作将正常继续
- **隔离的仓库**：Git仓库仅用于任务历史，与您的项目仓库完全分离
- **无合并冲突**：单文件跟踪与线性历史意味着不可能出现冲突

#### 优势：
- **完整历史**：使用标准Git工具查看任务的整个演变过程
- **更改跟踪**：准确查看任务何时以及如何被修改
- **恢复选项**：如有需要，可恢复以前的任务状态
- **团队可见性**：与团队成员共享任务历史

Git集成完全透明，无需配置。您可以随时使用以下命令查看历史：
```bash
cd <shrimp-data-directory>
git log --oneline
```

#### 如何查看任务历史

1. **导航到您的任务数据目录**（在您的`.mcp.json`中配置）：
   ```bash
   cd <shrimp-data-directory>
   ```

2. **查看提交历史**：
   ```bash
   git log --oneline
   ```

3. **查看特定更改**：
   ```bash
   git show <commit-hash>
   ```

4. **比较版本**：
   ```bash
   git diff HEAD~5  # 与5个提交前比较
   ```

5. **恢复以前的状态**（如有需要）：
   ```bash
   git checkout <commit-hash> -- tasks.json
   ```

### 📊 项目历史视图
**跟踪和分析您项目的任务执行历史**

SHRIMP-TASK-MANAGER在您每次启动新任务会话时会自动将已完成的任务保存到项目中的内存文件中。以前，这些有价值的历史数据隐藏在这些内存文件中，无法通过UI访问。新的项目历史视图公开了这个任务历史，允许您探索项目随时间的演变过程。

此功能使您能够：

- **历史任务快照**：浏览SHRIMP-TASK-MANAGER保存的项目过去状态
- **任务演变跟踪**：查看任务在不同会话中从创建到完成的进展情况
- **笔记系统**：为历史条目添加个人笔记，以供将来参考和团队知识共享
- **详细任务视图**：深入了解特定历史任务状态，以了解过去的决策和实现
- **基于时间的导航**：浏览项目时间线，查看何时完成了什么
- **快照比较**：比较不同时期的任务状态，跟踪项目增长和变化

![项目历史视图截图](/releases/project-history-view.png)

![项目历史详细视图截图](/releases/project-history-detail-view.png)

### 🎨 模板管理系统
**强大的AI任务执行模板自定义**

模板是指导SHRIMP-TASK-MANAGER分析和执行任务的核心指令。它们定义了AI应如何处理不同类型的操作，从规划和分析到实施和验证。MCP-TASK-MANAGER允许自定义模板，可以覆盖默认行为或向现有模板添加附加指令。

这个新的模板管理界面提供了直观的方式来：

- **模板编辑器**：功能齐全的markdown编辑器，带有语法高亮，用于制作自定义AI指令
- **模板预览**：激活前实时预览模板，确保它们满足您的要求
- **模板复制**：轻松创建现有模板的变体以用于不同用例
- **模板状态跟踪**：视觉指示器显示默认（原始）、自定义（完全替换）和自定义+追加（对默认的添加）状态
- **重置为默认**：需要时一键恢复原始模板
- **导出模板**：导出您的自定义模板以进行备份、与团队成员共享或版本控制
- **激活对话框**：激活模板时清晰确认，以防止意外更改

![模板管理系统截图](/releases/template-management-system.png)

### 🌍 国际化(i18n)支持
**多语言支持，无缝语言切换**

- **支持三种语言**：英语(en)、中文(中文)和西班牙语(Español)
- **持久的语言选择**：您的语言偏好被保存并记住
- **完整的UI翻译**：所有UI元素、按钮、标签和消息都已完全翻译
- **动态语言切换**：无需重新加载页面即可即时更改语言
- **语言上下文提供者**：集中的语言管理以确保一致的翻译

### 🧭 增强的导航和UI
**现代、直观的界面改进**

- **嵌套选项卡系统**：使用主要和次要选项卡组织导航
- **URL状态同步**：浏览器URL更新以反映当前视图
- **任务详情导航**：上一个/下一个按钮允许在不返回列表的情况下顺序查看任务
- **加载旋转器**：数据加载期间的视觉反馈
- **Toast通知**：非侵入式的成功/错误消息
- **响应式设计**：改进的移动和平板体验
- **模态框改进**：更好的模态框布局和交互
- **键盘导航**：支持箭头键在详细视图中更快地导航任务

## 🔄 重大改进

### 任务详情导航
**无缝的任务审查工作流程**

任务详情视图现在包含上一个/下一个导航按钮，这改变了您审查和处理任务的方式：

- **顺序导航**：无需返回主列表即可按顺序浏览任务
- **上下文保留**：在切换任务时保持在详细视图中
- **视觉指示器**：按钮显示任务编号（例如，"← 上一个（任务3）"和"下一个（任务5）→"）
- **智能边界**：导航按钮在第一个和最后一个任务时禁用
- **键盘快捷键**：使用箭头键进行更快的导航
- **效率提升**：查看整个任务列表的速度比来回点击快3-5倍

此功能在以下情况下特别有价值：
- 审查AI分析新创建的任务
- 处理一系列相关任务
- 检查多个相关任务的实施细节
- 执行任务审计或审查

### 性能增强
- **优化重新渲染**：React hooks正确记忆化以获得更好的性能
- **延迟加载**：组件按需加载以加快初始页面加载
- **高效的状态管理**：减少不必要的状态更新
- **批量更新**：多个状态更改批处理以获得更流畅的UI

### 开发者体验
- **全面的测试套件**：添加了集成和语言功能测试
- **测试清单**：结构化的测试文档
- **更好的错误处理**：更有信息的错误消息
- **调试日志**：增强的开发调试功能

### UI/UX改进
- **改进的任务表**：更好的列大小和文本换行
- **增强的模态框**：一致的模态框样式和行为
- **更好的排版**：通过更新的字体大小提高可读性
- **配色方案更新**：更易访问的颜色对比度
- **图标一致性**：整个应用程序中统一的图标使用

## 🐛 错误修复

### 关键修复
- **useRef Hook错误**：修复了导致应用程序崩溃的缺少React hook导入
- **翻译键**：为所有支持的语言添加了缺失的翻译键
- **符号链接循环**：解决了Screenshots目录无限循环问题
- **Windows路径处理**：修复了Windows 11上的file:// URI问题
- **仓库链接**：更正了所有仓库引用

### UI修复
- **模态框Z-index**：修复了模态框分层问题
- **选项卡选择**：修复了页面重新加载时的选项卡持久性
- **语言选择器**：修复了状态同步问题
- **复制功能**：提高了剪贴板操作的可靠性
- **响应式布局**：修复了移动视口问题

### 数据处理
- **配置文件加载**：修复了切换配置文件时的竞态条件
- **任务刷新**：提高了自动刷新的可靠性
- **历史加载**：修复了历史视图中的分页问题
- **模板保存**：解决了模板持久性错误

## 🏗️ 技术更新

### 新增依赖
- `@headlessui/react`：现代UI组件
- `@tanstack/react-table`：高级表功能
- `@uiw/react-md-editor`：模板的Markdown编辑
- 为TypeScript支持添加的额外类型定义

### API增强
- **GET /api/templates**：列出所有可用模板
- **PUT /api/templates/:name**：更新模板内容
- **POST /api/templates/:name/duplicate**：复制模板
- **GET /api/history/:profileId**：获取项目历史
- **增强的错误响应**：更详细的API错误消息

### 架构改进
- **组件模块化**：更好的关注点分离
- **自定义Hooks**：可重用逻辑提取到hooks中
- **上下文提供者**：集中的状态管理
- **实用函数**：常见操作的共享实用程序

## 📝 破坏性更改

### 配置更新
- **语言设置**：新的语言偏好存储格式
- **模板存储**：模板现在存储在用户主目录中
- **URL结构**：更新的URL模式以获得更好的导航

### API更改
- **配置文件端点**：更新的响应格式包含更多元数据
- **任务端点**：通过额外的筛选选项增强
- **模板端点**：模板管理的新端点结构

## 🚀 迁移指南

### 从v2.1到v3.0
1. **语言选择**：您的默认语言将是英语；从新选择器中选择首选语言
2. **模板**：现有的自定义模板将被保留，但可能需要重新激活
3. **浏览器缓存**：清除浏览器缓存以获得最佳性能
4. **配置文件数据**：所有现有配置文件将继续工作而无需更改

## 🎯 总结

版本3.0代表了Task Viewer的重大飞跃，将其从简单的任务可视化工具转变为全面的任务管理和自定义平台。通过完整的国际化支持、强大的模板管理、AI驱动的自动化和基于Git的历史跟踪功能，此版本为团队提供了对其AI辅助开发工作流程的前所未有的控制。

此版本的主要亮点包括：
- **AI驱动的代理分配**：利用GPT-4自动为任务分配最合适的代理
- **Git版本控制**：自动跟踪所有任务更改，带有时间戳的提交
- **多语言支持**：完整的国际化，支持英语、中文和西班牙语
- **模板管理**：通过模板编辑深度自定义AI行为
- **历史视图**：通过Git提交和内存快照完全了解项目演变

三种语言支持（英语、中文、西班牙语）的添加使该工具可供全球受众使用，而模板管理系统允许深度自定义AI行为。Git集成提供了所有任务修改的永久审计跟踪，AI驱动的批量分配功能大大加快了任务配置速度。

此版本为未来的增强奠定了基础，并将Task Viewer定位为现代AI辅助开发工具包中的重要工具。